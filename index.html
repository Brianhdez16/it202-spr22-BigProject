<!DOCTYPE html>
<html>

<head>
  <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>repl.it</title>
  <link href="style.css" rel="stylesheet" type="text/css" />
  <script src="https://unpkg.com/dexie/dist/dexie.js"></script>

  <style>
    #topnav {
      background-color: silver;
      padding: 4px;
    }

    #content {
      font-size: 2em;
    }

    /* .screen {display: none;} */
    body {
      margin: 0;
    }

    #content {
      margin: 3px;
    }

    .screen {
      display: none;
    }

      .dark{
        background-color: black;
        color: white;
      }
      .light{
        background-color: white;
        color: black;
      }
  </style>
</head>

<body>

  <aside class="mdc-drawer mdc-drawer--dismissible">
    <div class="mdc-drawer__content">
      <div class="mdc-list">
        <a class="mdc-list-item mdc-list-item--activated" href="#" aria-current="page">
          <span class="mdc-list-item__ripple"></span>
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">home</i>
          <span id="Main" class="mdc-list-item__text">Main</span>
        </a>
        <a class="mdc-list-item" href="#">
          <span class="mdc-list-item__ripple"></span>
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">info</i>
          <span id="Rick" class="mdc-list-item__text">Rick and Morty</span>
        </a>
        <a class="mdc-list-item" href="#">
          <span class="mdc-list-item__ripple"></span>
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">info</i>
          <span id="South" class="mdc-list-item__text">South Park</span>
        </a>
        <a class="mdc-list-item" href="#">
          <span class="mdc-list-item__ripple"></span>
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">settings</i>
          <span id="Setting" class="mdc-list-item__text">Settings</span>
        </a>
      </div>
    </div>
  </aside>

  <div class="mdc-drawer-app-content">
    <header class="mdc-top-app-bar app-bar" id="app-bar">
      <div class="mdc-top-app-bar__row">
        <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
          <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">menu</button>
          <span class="mdc-top-app-bar__title">Main Screen</span>
        </section>
      </div>
    </header>

    <main class="main-content" id="main-content">
      <div class="mdc-top-app-bar--fixed-adjust">
      </div>
      <section class="screen Main">H</section>
      <section class="screen Rick"></section>
      <section class="screen South">L</section>
      <section class="screen Setting"></section>
    </main>
  </div>

  <label id="label-switch" for="basic-switch" style="display: none;">Dark Mode</label>
  <button id="basic-switch" style="display: none;" class="mdc-switch mdc-switch--unselected" type="button" role="switch"
    aria-checked="false">
    <div class="mdc-switch__track"></div>
    <div class="mdc-switch__handle-track">
      <div class="mdc-switch__handle">
        <div class="mdc-switch__shadow">
          <div class="mdc-elevation-overlay"></div>
        </div>
        <div class="mdc-switch__ripple"></div>
        <div class="mdc-switch__icons">
          <svg class="mdc-switch__icon mdc-switch__icon--on" viewBox="0 0 24 24">
            <path d="M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z" />
          </svg>
          <svg class="mdc-switch__icon mdc-switch__icon--off" viewBox="0 0 24 24">
            <path d="M20 13H4v-2h16v2z" />
          </svg>
        </div>
      </div>
    </div>
  </button>




  <script>

    const drawerEl = document.querySelector('.mdc-drawer');
    const drawer = new mdc.drawer.MDCDrawer.attachTo(drawerEl);

    const topAppBar = new mdc.topAppBar.MDCTopAppBar(document.querySelector(".app-bar"));
    topAppBar.setScrollTarget(document.getElementById('main-content'));
    topAppBar.listen('MDCTopAppBar:nav', () => {
      drawer.open = !drawer.open;
    });
    document.querySelector(".body"), addEventListener("click", (e) => {
      drawer.open = false;
    });

    const listEl = document.querySelector('.mdc-drawer .mdc-list');
    const mainContentEl = document.querySelector('.main-content');
    let active = document.querySelector(".mdc-list-item--activated");
    let current = active.querySelector(".mdc-list-item__text").id;
    document.querySelector("." + current).style.display = "block";

    //Same Character Every Time    
    let page = Math.floor((Math.random() * 42) + 1);
    let character = Math.floor((Math.random() * 20) + 1);
    if (page == 42) {
      character = Math.floor((Math.random() * 6) + 1);
    }
    let once = true;
    listEl.addEventListener('click', (event) => {
      active = document.querySelector(".mdc-list-item--activated")
      let next = active.querySelector(".mdc-list-item__text").id
      if (current != next) {
        document.querySelector("." + next).style.display = "block";
        document.querySelector("." + current).style.display = "none";
      }
      current = next;

      if (current == "Rick") {
        //Different Character Every Time  
        // let page = Math.floor((Math.random() * 42)+1);
        // let character = Math.floor((Math.random() * 20)+ 1);
        // if(page == 42){
        //   character = Math.floor((Math.random() * 6)+ 1);
        // }
        let rUrl = "https://rickandmortyapi.com/api/character?page=";
        let tPage = page.toString();
        let url = rUrl.concat(tPage);
        fetch(url)
          .then((response) => {
            return response.json();
          })
          .then((json) => {
            //console.log(json.results[character]);
            if (once) {
              let img = document.createElement("img");
              img.src = json.results[character].image;
              document.querySelector("." + current).appendChild(img);

              let h = document.createElement("p");
              let t = document.createTextNode("Name: " + json.results[character].name);
              h.appendChild(t);
              document.querySelector("." + current).appendChild(h);
              h = document.createElement("p");
              t = document.createTextNode("Status: " + json.results[character].status);
              h.appendChild(t);
              document.querySelector("." + current).appendChild(h);
              h = document.createElement("p");
              t = document.createTextNode("Species: " + json.results[character].species);
              h.appendChild(t);
              document.querySelector("." + current).appendChild(h);

              once = false;
            }
          })

      }
      if (current == "Setting") {
        document.querySelector("#basic-switch").style.display = "block";
        document.querySelector("#label-switch").style.display = "block";
        const db = new Dexie("app_data");

        db.version(1).stores({
          settings: 'name'
        });
        const mSwitch = new mdc.switchControl.MDCSwitch(document.querySelector(".mdc-switch"));

        db.settings.where("name").equals("mode").toArray((arr) => {
          if (arr.length == 0) {
            db.settings.add({name: "mode", value: "light"})
          }
          else {
            let mode = arr[0]["value"];
            document.querySelector("body").className = mode;
            if (mode == "dark") {
              mSwitch.selected = true;
            }
          }
        });
        document.querySelector(".mdc-switch"), addEventListener("click", (e) => {
          let newMode = mSwitch.selected ? "dark" : "light";
          document.querySelector("body").className = newMode;
          db.settings.put({name: "mode", value: newMode});
        })
      }

    });//END CLICK HANDLER
  </script>


</body>

</html>